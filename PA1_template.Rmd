---
title: "Reproducible Research:Peer-graded Assignment 1"
author: "LB"
date: "2024-01-05"
output: html_document
keep_md: true
---

## Loading and preprocessing data
This assignment demonstrate how to prepare the environment with all the R libraries required to perform the data analysis as well as the locations of the source file. Then the data is read into a dataframe.
## Uploading R libraries needed
  These are the packages and libraries required
  
"dplyr"

"ggplot2"

"plotly"

"lemon"


```` {r include = FALSE}
library("dplyr")
library("ggplot2")
library(plotly)
library(lemon)
knit_print.data.frame <- lemon_print
unzip("repdata_data_activity.zip")
````

## Reading the data
Here is the location of the data source needed (previously provided by the assignment instruction page)

setwd <<Path to location>>
````{r, echo = FALSE}
setwd("/Users/lubravo19/Documents/Labinfo/Cousera trainings/Reproducible Research/assignment week2/assignment2")
````
The comma separated file is extracted for the provided "zip" file

unzip("repdata_data_activity.zip")
````{r, echo = FALSE}
unzip("repdata_data_activity.zip")
````

Then all the data content is uploaded into the dataframe named "act_df" and ready to be processed

act_df\<\-read.csv("activity.csv")
```` {r,echo = FALSE}
act_df<-read.csv("activity.csv")
act_df$date<-as.Date(act_df$date)
````
and Transform the date character into an r date variable

act_df\$date\<-as.Date(act_df\$date)

Here are the questions posed by the assignment and my analysis

## What is mean total number of steps taken per day?
The total number of steps taken each day of the experiment is shown on the following table
````{r, echo = FALSE}
st_bydy_sum<-aggregate(steps ~ date,data = act_df, FUN = "sum", na.rm = T)
names(st_bydy_sum)[names(st_bydy_sum) == "steps"]<-"Total_steps"
````
````{r caption="Total number of steps by dates",render=lemon_print,echo = FALSE}
head(st_bydy_sum, n = 100)
````
Here is the histogram plot for the total number of steps taken each day
```` {r, echo = FALSE}
pl1<-ggplot(data = st_bydy_sum,aes(x=date, y=Total_steps)) + geom_col(color = "blue",fill = "blue") + labs(x="Dates", y = "Tota Steps") + theme_bw()
ggplotly(pl1)
````
___The highest number of steps where collected on November 22 and 23 of 2012.___

The assignment asked to calculate the mean number of steps and here is the table with the data
```` {r,echo = FALSE}
st_bydy_mean<-aggregate(steps ~ date,data = act_df, FUN = "mean", na.rm = T)
names(st_bydy_mean)[names(st_bydy_mean) == "steps"]<-"average_steps"
mn_rows<-nrow(st_bydy_mean)
````

```` {r caption="Mean number steps by dates",render=lemon_print,echo = FALSE}
head(st_bydy_mean, n = 100)
````
Total number of observations `r mn_rows`

As well as the median steps by date
```` {r,echo = FALSE}
st_bydy_median<-aggregate(steps ~ date, data = act_df, FUN = (function(x){ifelse(sum(x==0) > 0 & sum(x != 0) > 0,median(x[x>0]), median(x))}))

names(st_bydy_median)[names(st_bydy_median) == "steps"]<-"median_steps"
me_rows<-nrow(st_bydy_median)
````


```` {r caption="Median number steps by dates",render=lemon_print,echo = FALSE}
head(st_bydy_median, n = 100)
````
Total number of observations `r me_rows`

_All this data was calculated by ignoring the NA values from the source data_

## What is the average daily activity pattern?
```` {r,echo = FALSE}
st_bydy_5min<-aggregate(steps ~ interval,data=act_df, FUN = (function(x){ifelse(sum(x==0) > 0 & sum(x != 0) > 0,mean(x[x>0]), mean(x))})) 

plotl<-ggplot(st_bydy_5min, aes(x = interval,y= steps))+ geom_line(color = "blue")  + labs(y = "Average number of steps", x = "Intervals") + theme_bw()
ggplotly(plotl)

````
___The plot shows that interval "835" contains the maximum number of average steps with a value of 352.___

### Imputing missing values
I used the average step calculation per interval to replace the NA values in the original source data.
I added a new dataframe to hold the updated data
```` {r, echo = FALSE}
## NA value report

miss_vals<-sum(is.na(act_df$steps))
## adding mean to NA

idx_nas<-is.na(act_df$steps)

## Calculate average steps by intervals

st_bydy_int_avg<-aggregate(steps ~ interval,data=act_df, FUN = (function(x){ifelse(sum(x==0) > 0 & sum(x != 0) > 0,mean(x[x>0]), mean(x))})) 

names(st_bydy_int_avg)[names(st_bydy_int_avg) == "steps"]<-"average_steps"

## Replace NAs with mean values
act_df_imp<- act_df
## Replace NA values with avreage steps by interval
act_df_imp = act_df_imp %>% left_join(st_bydy_int_avg, by="interval") %>% mutate(steps = ifelse(is.na(steps),average_steps,steps), .keep='unused')

````
Here is the histogram plot for the updated data
```` {r, echo = FALSE}
pl2<-ggplot(data = act_df_imp,aes(x=date, y=steps)) + geom_col(color = "blue",fill = "blue") + labs(x="Dates", y = "Steps") + theme_bw()
ggplotly(pl2)
````
The assignment asked to recalculate the mean number of steps and here is the table with the data
```` {r,echo = FALSE}

st_bydy_mean2<-aggregate(steps ~ date,data = act_df_imp, FUN = "mean", na.rm = T)
names(st_bydy_mean2)[names(st_bydy_mean2) == "steps"]<-"average_steps"
me_rows2<-nrow(st_bydy_mean2)
````

```` {r caption="Mean number steps by dates (with imputted data)",render=lemon_print,echo = FALSE}
head(st_bydy_mean2, n = 100)
````
As well as to recalculate median steps by date
```` {r,echo = FALSE}
st_bydy_median2<-aggregate(steps ~ date, data = act_df_imp, FUN = (function(x){ifelse(sum(x==0) > 0 & sum(x != 0) > 0,median(x[x>0]), median(x))}))
names(st_bydy_median2)[names(st_bydy_median2) == "steps"]<-"median_steps"
me_rows2<-nrow(st_bydy_median2)
````


```` {r caption="Median number steps by dates (with imputted data)",render=lemon_print,echo = FALSE}
head(st_bydy_median2, n = 100)
````
___These updated calculations differ from the earlier ones since we have replaced all NA values with average steps and that also increased the number of observations from `r me_rows` to `r me_rows2`___

## Are there differences in activity patterns between weekdays and weekends?
Here are the time series plots that show the total number of steps on weekdays and weekends

```` {r, echo = FALSE}
## Weekends and weekdays analysis

## adding factor based on weekdays and weekends

act_df_imp$weekfact <- factor(ifelse(weekdays(act_df_imp$date, abbr = TRUE) %in% c("Sat","Sun"), "Weekends","Weekdays"))
## Plots
## New average steps 

st_bydy_int_avg2<-aggregate(steps ~ interval + weekfact,data=act_df_imp, FUN = (function(x){ifelse(sum(x==0) > 0 & sum(x != 0) > 0,mean(x[x>0]), mean(x))})) 


weekpl<- ggplot(st_bydy_int_avg2, aes(x = interval,y= steps))+ geom_line(color = "blue")  + labs(y = "Number of steps", x = "5 minute intervals") + facet_wrap(~weekfact,ncol=1) + theme_bw()
ggplotly(weekpl)
````
___This data shows that the maximum number steps taken is higher during weekdays 387 than the weekends maximum of 334___
___Also, the peak intervals for weekdays runs in the range of 535:905 in comparison to the weekends range of 1530:1700___